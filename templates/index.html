<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>VHDS Health 自我健康管理</title>

<style>

body{
    background:#0b0f14;
    color:#e8f1ff;
    font-family:-apple-system,BlinkMacSystemFont;
    text-align:center;
}

.container{
    max-width:420px;
    margin:auto;
    padding:20px;
}

.title{
    font-size:26px;
    margin-bottom:20px;
}

/* 語言按鈕 */

.lang-btn{
    padding:8px 14px;
    margin:4px;
    border-radius:8px;
    border:1px solid #00eaff;
    background:transparent;
    color:#00eaff;
    cursor:pointer;
}

.lang-btn:hover{
    background:#00eaff;
    color:#000;
}

/* 模式按鈕 */

.mode-btn{
    width:100%;
    padding:14px;
    margin:6px;
    border-radius:12px;
    border:none;
    background:linear-gradient(90deg,#00eaff,#0066ff);
    color:white;
    font-size:16px;
    cursor:pointer;
}

.mode-btn:hover{
    opacity:0.8;
}

/* 上傳 */

.upload-box{
    margin-top:20px;
}

/* canvas */

#heatmapCanvas{
    margin-top:20px;
    background:transparent;
}

/* 雷達圖 */

#radarChart{
    margin-top:20px;
}

/* 報告 */

.report{
    text-align:left;
    margin-top:20px;
    background:#111826;
    padding:15px;
    border-radius:10px;
}

.score{
    color:#00eaff;
}

</style>

</head>

<body>

<div class="container">

<div class="title">
VHDS Health 自我健康管理
</div>

<!-- 語言選擇 -->

<div>

<button class="lang-btn" onclick="setLang('zh')">中文</button>
<button class="lang-btn" onclick="setLang('en')">English</button>
<button class="lang-btn" onclick="setLang('ja')">日本語</button>
<button class="lang-btn" onclick="setLang('ko')">한국어</button>

</div>


<!-- 模式選擇 -->

<div>

<button class="mode-btn" onclick="setMode(1)">
健康管理
</button>

<button class="mode-btn" onclick="setMode(2)">
肌膚管理
</button>

<button class="mode-btn" onclick="setMode(3)">
面相學分析
</button>

<button class="mode-btn" onclick="setMode(4)">
心理學分析
</button>

</div>


<!-- 上傳照片 -->

<div class="upload-box">

<input type="file" id="photo">

<button class="mode-btn" onclick="analyze()">
開始分析
</button>

</div>


<!-- 人體熱區圖 -->

<canvas id="heatmapCanvas" width="320" height="600"></canvas>


<!-- 雷達圖 -->

<canvas id="radarChart" width="320" height="320"></canvas>


<!-- 報告 -->

<div id="report" class="report"></div>

</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/static/heatmap.js"></script>


<script>

let currentLang="zh";
let currentMode=1;


function setLang(lang){
    currentLang=lang;
}

function setMode(mode){
    currentMode=mode;
}


async function analyze(){

    const file=document.getElementById("photo").files[0];

    if(!file){
        alert("請上傳照片");
        return;
    }

    const formData=new FormData();
    formData.append("photo",file);
    formData.append("mode",currentMode);
    formData.append("lang",currentLang);

    const res=await fetch("/analyze",{
        method:"POST",
        body:formData
    });

    const data=await res.json();

    showReport(data);
    showRadar(data);
    drawHeatmap(data.heatmap);

}


function showReport(data){

    let html="";

    data.indicators.forEach(item=>{

        html+=`
        <div>
        <b>${item.name}</b><br>
        <span class="score">${item.score}</span><br>
        ${item.desc}
        <hr>
        </div>
        `;
    });

    document.getElementById("report").innerHTML=html;
}


function showRadar(data){

    const ctx=document.getElementById("radarChart");

    new Chart(ctx,{
        type:'radar',
        data:{
            labels:data.indicators.map(i=>i.name),
            datasets:[{
                data:data.indicators.map(i=>i.score),
                borderColor:"#00eaff",
                backgroundColor:"rgba(0,234,255,0.2)"
            }]
        },
        options:{
            scales:{
                r:{
                    min:0,
                    max:100
                }
            }
        }
    });

}

</script>


</body>
</html>
