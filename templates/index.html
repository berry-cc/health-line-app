<!DOCTYPE html>
<html lang="zh">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>VHDS Health 自我健康管理</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

body{
    background:#0b0f14;
    color:white;
    font-family:-apple-system,BlinkMacSystemFont;
    text-align:center;
}

.container{
    max-width:420px;
    margin:auto;
    padding:20px;
}

button{

    background:linear-gradient(45deg,#00eaff,#0078ff);

    border:none;

    padding:12px;

    margin:5px;

    color:white;

    border-radius:10px;

    font-size:14px;

    cursor:pointer;

    box-shadow:0 0 15px rgba(0,234,255,0.4);
}

canvas{
    margin-top:20px;
}

#heatmapCanvas{

    filter: drop-shadow(0 0 20px rgba(255,80,80,0.7));

}

#radarChart{

    filter: drop-shadow(0 0 20px rgba(0,234,255,0.7));

}

</style>

</head>

<body>

<div class="container">

<h2>VHDS Health 自我健康管理</h2>

<input type="file" id="photo">

<br><br>

<button onclick="startAnalysis()">開始分析</button>

<br><br>

<!-- 語言按鈕 -->

<button onclick="setLang('zh')">中文</button>
<button onclick="setLang('en')">English</button>
<button onclick="setLang('jp')">日本語</button>
<button onclick="setLang('kr')">한국어</button>

<br><br>

<!-- 人體熱區 -->

<canvas id="heatmapCanvas" width="250" height="400"></canvas>

<!-- 雷達圖 -->

<canvas id="radarChart" width="320" height="320"></canvas>

<div id="result"></div>

</div>

<script>

let currentLang="zh";

function setLang(lang){
    currentLang=lang;
}

async function startAnalysis(){

    const file=document.getElementById("photo").files[0];

    const formData=new FormData();

    formData.append("photo",file);

    formData.append("mode","health");

    formData.append("lang",currentLang);

    const res=await fetch("/analyze",{method:"POST",body:formData});

    const data=await res.json();

    showRadar(data);

    showHeatmap(data);

    showText(data);

}

function showText(data){

    let html="";

    data.indicators.forEach(i=>{

        html+=`<p>${i.name} ${i.score}/100<br>${i.desc}</p>`;

    });

    document.getElementById("result").innerHTML=html;

}

/* 雷達圖發光版本 */

let radarChart=null;

function showRadar(data){

    const ctx=document.getElementById("radarChart").getContext("2d");

    const values=data.indicators.map(i=>i.score);

    const gradient=ctx.createRadialGradient(
        160,160,20,
        160,160,160
    );

    gradient.addColorStop(0,"rgba(0,234,255,0.9)");
    gradient.addColorStop(0.5,"rgba(0,150,255,0.4)");
    gradient.addColorStop(1,"rgba(0,0,0,0)");

    if(radarChart){
        radarChart.destroy();
    }

    radarChart=new Chart(ctx,{

        type:"radar",

        data:{
            labels:data.indicators.map(i=>i.name),

            datasets:[{

                data:values,

                borderColor:"#00eaff",

                borderWidth:2,

                backgroundColor:gradient,

                pointBackgroundColor:"#00eaff",

                pointRadius:3,

                pointHoverRadius:6

            }]
        },

        options:{

            responsive:false,

            animation:{
                duration:2000,
                easing:"easeInOutSine"
            },

            scales:{
                r:{
                    min:0,
                    max:100,

                    grid:{
                        color:"rgba(0,234,255,0.15)"
                    },

                    angleLines:{
                        color:"rgba(0,234,255,0.2)"
                    },

                    pointLabels:{
                        color:"#8fdfff",
                        font:{size:11}
                    },

                    ticks:{display:false}
                }
            },

            plugins:{
                legend:{display:false}
            }
        }
    });

    animateRadarGlow();

}

/* 呼吸動畫 */

function animateRadarGlow(){

    let intensity=0;

    let direction=1;

    setInterval(()=>{

        intensity+=direction*0.02;

        if(intensity>1) direction=-1;

        if(intensity<0) direction=1;

        const canvas=document.getElementById("radarChart");

        canvas.style.filter=
        `drop-shadow(0 0 ${20+intensity*25}px rgba(0,234,255,0.8))`;

    },50);

}

/* 人體熱區 */

function showHeatmap(data){

    const canvas=document.getElementById("heatmapCanvas");

    const ctx=canvas.getContext("2d");

    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.fillStyle="rgba(255,255,255,0.1)";

    ctx.fillRect(100,50,50,200);

    data.indicators.forEach((i,index)=>{

        const intensity=i.score/100;

        ctx.beginPath();

        ctx.arc(125,80+index*25,10,0,2*Math.PI);

        ctx.fillStyle=`rgba(255,80,80,${intensity})`;

        ctx.fill();

    });

}

</script>

</body>

</html>
