<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>VHDS V3</title>

<style>
body{
  background:#0b1020;
  color:white;
  font-family:sans-serif;
  margin:20px;
}

.card{
  background:#121933;
  padding:16px;
  border-radius:12px;
  margin-top:16px;
}

button{
  padding:8px 14px;
  border-radius:8px;
  border:none;
  background:#2a3cff;
  color:white;
}

.langBtn{
  background:#1b2550;
  margin-right:6px;
}
</style>

</head>
<body>

<!-- 語言切換 -->
<div>
<button class="langBtn" onclick="setLang('zh')">中文</button>
<button class="langBtn" onclick="setLang('en')">EN</button>
<button class="langBtn" onclick="setLang('ja')">日本語</button>
<button class="langBtn" onclick="setLang('ko')">한국어</button>
</div>

<h2 id="title">VHDS V3 分析系統</h2>

<form method="POST" action="/analyze" enctype="multipart/form-data">

<div>
<span id="label_age">年齡</span><br>
<input id="age" name="age" value="{{age}}">
</div>

<div>
<span id="label_height">身高</span><br>
<input id="height" name="height" value="{{height}}">
</div>

<div>
<span id="label_weight">體重</span><br>
<input id="weight" name="weight" value="{{weight}}">
</div>

<div>
<span id="label_waist">腰圍</span><br>
<input id="waist" name="waist" value="{{waist}}">
</div>

<div>
<span id="label_mode">模式</span><br>
<select id="mode" name="mode">
<option value="health" {% if mode_selected=="health" %}selected{% endif %}>Health</option>
<option value="skin" {% if mode_selected=="skin" %}selected{% endif %}>Skin</option>
<option value="face" {% if mode_selected=="face" %}selected{% endif %}>Face</option>
<option value="psy" {% if mode_selected=="psy" %}selected{% endif %}>Psy</option>
</select>
</div>

<div>
<span id="label_photo">上傳照片</span><br>
<input type="file" id="photos" name="photo" multiple>
<div id="preview"></div>
</div>

<br>

<button type="submit" id="btn_analyze">開始分析</button>

</form>

{% if result %}

<script>
window.VHDS_RESULT = {{ result | tojson }};
</script>

<div class="card">

<h3 id="label_overall">
總分: {{ result["overall"] }}
</h3>

<!-- 雷達圖 -->
<canvas id="radarCanvas" width="320" height="320"></canvas>

<div id="resultList">

{% for item in result["items"] %}

<div>
{{ item["name"] }} :
{{ item["score"] }}
<br>
<span style="opacity:0.7">{{ item["desc"] }}</span>
</div>

{% endfor %}

</div>

</div>

{% endif %}


<!-- radar.js -->
<script src="/static/radar.js"></script>


<script>

/* 語言資料 */

const LANG={

zh:{
title:"VHDS V3 分析系統",
age:"年齡",
height:"身高",
weight:"體重",
waist:"腰圍",
mode:"模式",
photo:"上傳照片",
analyze:"開始分析",
overall:"總分"
},

en:{
title:"VHDS V3 Analysis",
age:"Age",
height:"Height",
weight:"Weight",
waist:"Waist",
mode:"Mode",
photo:"Upload Photo",
analyze:"Analyze",
overall:"Overall Score"
},

ja:{
title:"VHDS V3 分析システム",
age:"年齢",
height:"身長",
weight:"体重",
waist:"ウエスト",
mode:"モード",
photo:"写真アップロード",
analyze:"分析開始",
overall:"総合スコア"
},

ko:{
title:"VHDS V3 분석 시스템",
age:"나이",
height:"키",
weight:"체중",
waist:"허리둘레",
mode:"모드",
photo:"사진 업로드",
analyze:"분석 시작",
overall:"총점"
}

};


/* 語言切換 */

function setLang(lang){

localStorage.setItem("lang",lang);

applyLang();

}


function applyLang(){

const lang=localStorage.getItem("lang")||"zh";

const L=LANG[lang];

title.innerText=L.title;

label_age.innerText=L.age;

label_height.innerText=L.height;

label_weight.innerText=L.weight;

label_waist.innerText=L.waist;

label_mode.innerText=L.mode;

label_photo.innerText=L.photo;

btn_analyze.innerText=L.analyze;

if(label_overall)
label_overall.innerText=
L.overall+": "+VHDS_RESULT.overall;

}


/* 保留輸入 */

function saveInputs(){

localStorage.setItem("age",age.value);
localStorage.setItem("height",height.value);
localStorage.setItem("weight",weight.value);
localStorage.setItem("waist",waist.value);
localStorage.setItem("mode",mode.value);

}

function loadInputs(){

age.value=localStorage.getItem("age")||"";
height.value=localStorage.getItem("height")||"";
weight.value=localStorage.getItem("weight")||"";
waist.value=localStorage.getItem("waist")||"";
mode.value=localStorage.getItem("mode")||"health";

}


document.addEventListener("input",saveInputs);

window.onload=function(){

applyLang();
loadInputs();

if(window.VHDS_RESULT){

const labels=VHDS_RESULT.items.map(x=>x.name);
const values=VHDS_RESULT.items.map(x=>x.score);

if(typeof drawRadar==="function")
drawRadar("radarCanvas",labels,values);

}

};


/* 縮圖 */

photos.onchange=e=>{

preview.innerHTML="";

for(const file of e.target.files){

const img=document.createElement("img");

img.src=URL.createObjectURL(file);

img.width=80;

preview.appendChild(img);

}

};

</script>

</body>
</html>
